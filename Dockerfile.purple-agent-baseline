# Dockerfile for QBench Purple Agent Baseline (GPT-5.2)
# Multi-arch compatible - use buildx to specify target platform
# GitHub Actions: docker buildx build --platform linux/amd64
FROM python:3.13-slim

WORKDIR /app

# Copy project files
COPY examples/agentbeats/gpt52_purple_agent.py /app/
COPY examples/agentbeats/gpt52_prompt.py /app/
COPY pyproject.toml README.md /app/

# Install curl for health checks
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# Install uv for dependency management
RUN pip install --no-cache-dir uv

# Install dependencies
# Extract only the required dependencies for purple agent
RUN pip install --no-cache-dir \
    "pydantic>=2.0.0" \
    "a2a-sdk>=0.3.5" \
    "fastapi>=0.115.0" \
    "starlette>=0.48.0" \
    "sse-starlette>=2.0.0" \
    "uvicorn>=0.35.0" \
    "httpx>=0.27.0" \
    "python-dotenv>=1.0.0" \
    "litellm>=1.0.0" \
    "loguru>=0.7.0"

# Expose port 8080 (AgentBeats standard)
EXPOSE 8080

# Set entrypoint to run the purple agent
# Accept --host and --port arguments for flexibility
ENTRYPOINT ["python", "gpt52_purple_agent.py"]

# Default arguments (override code default of 9019 â†’ 8080 for container)
CMD ["--host", "0.0.0.0", "--port", "8080"]
